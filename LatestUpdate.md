Project: Farm Sentinel (V1.0)Goal: Solar-powered farm monitoring (Soil + Security) with Cellular Upload.1. System ArchitectureNetwork Protocol: ESP-NOW (Private Wi-Fi, Mac-to-Mac).Topology: Star Topology (Multiple Spokes -> One Central Hub).Uplink: 4G LTE (Jio) via SIM7600/EC200U Modem.Cloud: Google Cloud Functions (Python) + BigQuery + Cloud Storage.2. Hardware & Pin MapsA. Spoke 1: Soil MonitorHardware: ESP32 (WROOM) + Capacitive Soil Sensor.Power: Li-ion Battery (Sleeps 99% of time).Logic: Wakes every 30 mins -> Reads Analog -> Sends Struct -> Sleeps.B. Spoke 2: Security CameraHardware: ESP32-CAM (AI Thinker).Power: Li-ion Battery (Hunter Mode).Logic:Wakes up (Light sleep).Hunter Mode: Pings Hub every 1s for up to 60s.Sync: If ACK received -> Init Camera -> Snap -> Send Chunks -> Sleep 30m.Fail: If no ACK -> Sleep 2m -> Retry.ESP32-CAM PinComponentGPIO 4Flashlight (Optional)GPIO 33Red LED (Inverted)U0TX/RXProgramming/Debug3.3V/5VPower InputC. The Hub: The BrainHardware: ESP32 (DevKit) + EC200U (or SIM7600) + DS3231 RTC.Storage: SPIFFS (Internal Flash) for image buffering.Schedule: Wakes at xx:28 and xx:58 (stays awake 5 mins).Hub PinComponentFunctionGPIO 16Modem TXRX (Serial2)GPIO 17Modem RXTX (Serial2)GPIO 18Modem PWRPower Key (Pulse to wake)SDA (21)DS3231 RTCI2C DataSCL (22)DS3231 RTCI2C Clock3. Software Logic (The "Secret Sauce")The Synchronization Hack (Hunter Protocol)Since the Spoke has no RTC, it cannot know when the Hub is awake.Hub wakes at fixed times (xx:28) based on its high-precision DS3231.Spoke uses a "Hunt and Peck" strategy:It wakes up and "pings" the Hub.If Hub is Asleep: No ACK. Spoke sleeps for 2 minutes and tries again.If Hub is Awake: Hardware ACK received. Spoke fires data immediately.Result: The Spoke naturally "drifts" into alignment with the Hub's window.The Image Transfer (Chunking)ESP-NOW cannot send 15KB images in one go (Max 250 bytes).Spoke: Splits JPEG into 240-byte chunks and blasts them.Hub:Detects len > 50 = "This is a Camera Chunk".Opens /cam_capture.jpg in SPIFFS.Appends data until silence > 2 seconds.Upload: Hub reads file from SPIFFS and uses Multipart POST to GCP.4. Deployment Checklist (The "Go Live" Steps)Final Code Cleanup:Hub: Open main.cpp. Search for manageSleep. DELETE return;.Hub: ensure WIFI_CHANNEL = 1.Spoke: ensure hubMacAddress matches the Hub.Power Sequence:Turn on Hub first. Let it stabilize (it might sleep immediately, that's fine).Turn on Spoke.Physical Install:Antennas: Ensure the Modem (LTE) and WiFi antennas are perpendicular if possible.Waterproofing: Use silica gel packets inside your box. Condensation kills ESP32-CAMs.Verification:Wait 30-60 minutes.Check Google Cloud Storage.Note: Do not panic if you miss the first cycle. The "Hunter" algorithm might take 1-2 cycles to sync up perfectly.
